<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New College Event | Single-Step Form</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Apply Poppins to all elements */
        body {
            font-family: 'Poppins', sans-serif;
        }
        /* Custom styles for animations and components */
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tag-pill {
            @apply inline-flex items-center text-sm bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full mr-2 mb-2 font-medium transition-colors hover:bg-indigo-200;
        }
        .input-error {
            @apply border-red-500 ring-2 ring-red-500/50;
        }
        .input-success {
            @apply border-green-500 ring-2 ring-green-500/50;
        }
        /* Toggle Switch Styling */
        .form-switch {
            @apply relative inline-block w-12 h-6 mr-2 align-middle select-none transition duration-200 ease-in;
        }
        .form-switch input {
            @apply absolute opacity-0 w-0 h-0;
        }
        .form-switch .slider {
            @apply block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer;
        }
        .form-switch .slider:before {
            content: "";
            @apply block w-6 h-6 bg-white rounded-full absolute top-0 left-0 transition-transform duration-300 shadow;
        }
        .form-switch input:checked + .slider {
            @apply bg-green-600;
        }
        .form-switch input:checked + .slider:before {
            transform: translateX(24px);
        }
    </style>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 antialiased min-h-screen flex">

    <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-gray-900 text-white transition-transform duration-300 ease-in-out transform -translate-x-full lg:translate-x-0 shadow-2xl">
        <div class="h-full flex flex-col">
            <div class="p-6 flex-shrink-0">
                <p class="text-2xl font-bold text-indigo-400">Campus<span class="text-white">Events</span></p>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
                <a href="/dashboard" class="group flex items-center px-4 py-2 text-sm font-medium rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition-all">
                    <i data-lucide="home" class="mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-300 transition-colors"></i>
                    Dashboard
                </a>
                <a href="/create-event" class="group flex items-center px-4 py-2 text-sm font-medium rounded-lg bg-indigo-600 text-white transition-all shadow-lg shadow-indigo-600/30">
                    <i data-lucide="calendar-plus" class="mr-3 h-5 w-5 transition-colors"></i>
                    Create Event
                </a>
                <a href="/events" class="group flex items-center px-4 py-2 text-sm font-medium rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition-all">
                    <i data-lucide="calendar" class="mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-300 transition-colors"></i>
                    My Events
                </a>
                <a href="/settings" class="group flex items-center px-4 py-2 text-sm font-medium rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition-all">
                    <i data-lucide="cog" class="mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-300 transition-colors"></i>
                    Settings
                </a>
            </nav>
        </div>
    </aside>

    <div id="sidebar-overlay" class="fixed inset-0 z-40 bg-black opacity-50 hidden lg:hidden" aria-hidden="true"></div>

    <div class="flex-1 flex flex-col lg:ml-64 transition-all duration-300">

        <header class="p-4 bg-white border-b border-gray-200 sticky top-0 z-30 flex justify-between items-center shadow-md">
            <div class="flex items-center">
                <button id="menu-toggle" class="lg:hidden p-2 text-gray-600 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-md mr-4" aria-label="Open sidebar">
                    <i data-lucide="menu" class="h-6 w-6"></i>
                </button>
                <div>
                    <h1 class="text-2xl font-semibold text-gray-900">Create a New College Event</h1>
                    <p class="text-sm text-gray-500 hidden sm:block">Organize and publish campus events with ease.</p>
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button type="button" class="text-sm px-4 py-2 border rounded-full text-gray-700 border-gray-300 hover:bg-gray-100 transition-transform duration-200 hover:scale-105" aria-label="Save draft">
                    <i data-lucide="bookmark" class="h-4 w-4 inline-block mr-1"></i>
                    Save Draft
                </button>
                <button type="submit" form="event-form" class="text-sm px-4 py-2 bg-indigo-600 text-white rounded-full font-medium hover:bg-indigo-700 transition-transform duration-200 hover:scale-105 shadow-md shadow-indigo-500/50" aria-label="Publish event">
                    <i data-lucide="send" class="h-4 w-4 inline-block mr-1"></i>
                    Publish
                </button>
            </div>
        </header>

        <main class="flex-1 flex min-h-0">
            
            <section class="flex-1 p-4 md:p-8 overflow-y-auto max-w-full xl:max-w-4xl">
                <form id="event-form" class="space-y-8">
                    <div class="bg-white shadow-xl rounded-xl p-6 md:p-8">
                        
                        <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center">
                            <i data-lucide="file-text" class="h-7 w-7 mr-3 text-indigo-600"></i> Event Submission Form
                        </h2>
                        <p class="text-gray-600 mb-8 border-b pb-4">Fill out the following sections to create and publish your college event.</p>

                        <div id="event-info-section" class="space-y-10">
                            
                            <fieldset class="border border-gray-200 p-5 rounded-xl space-y-4">
                                <legend class="text-lg font-semibold px-2 text-gray-700 flex items-center"><i data-lucide="layout-grid" class="h-5 w-5 mr-2 text-indigo-500"></i> Basic Details</legend>
                                
                                <div>
                                    <label for="event-title" class="block text-sm font-medium text-gray-700">Event Title <span class="text-red-500">*</span></label>
                                    <input type="text" id="event-title" name="title" placeholder="e.g. AI Workshop 2025" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                </div>
                                
                                <div class="grid sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="event-path" class="block text-sm font-medium text-gray-700">Event Path (URL Slug) <span class="text-red-500">*</span></label>
                                        <div class="flex rounded-lg shadow-sm">
                                            <span class="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">/events/</span>
                                            <input type="text" id="event-path" name="path" placeholder="my-ai-workshop" required oninput="sanitizePath(event)" class="flex-1 min-w-0 block w-full px-4 py-2 border border-gray-300 rounded-r-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                        </div>
                                        <p id="path-feedback" class="text-xs text-gray-500 mt-1">URL: [Your College Site]/events/<span class="font-semibold text-indigo-600" id="live-path">event-path-here</span></p>
                                    </div>
                                    <div>
                                        <label for="event-category" class="block text-sm font-medium text-gray-700">Category <span class="text-red-500">*</span></label>
                                        <select id="event-category" name="category" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all bg-white">
                                            <option value="" disabled selected>Select a category</option>
                                            <option value="Technical">Technical üßë‚Äçüíª</option>
                                            <option value="Cultural">Cultural üé®</option>
                                            <option value="Sports">Sports ‚öΩ</option>
                                            <option value="Workshop">Workshop üõ†Ô∏è</option>
                                            <option value="Seminar">Seminar üé§</option>
                                            <option value="Festival">Festival üéâ</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="event-description" class="block text-sm font-medium text-gray-700">Description <span class="text-red-500">*</span></label>
                                    <textarea id="event-description" name="description" placeholder="Brief description of the event..." rows="5" required maxlength="500" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></textarea>
                                    <p class="text-xs text-right text-gray-500 mt-1">
                                        <span id="char-count">0</span>/500 characters
                                    </p>
                                </div>
                                
                                <div>
                                    <label for="event-tags-input" class="block text-sm font-medium text-gray-700 mb-2">Tags (Press Enter to add, Max 5)</label>
                                    <div class="flex flex-wrap items-center border border-gray-300 rounded-lg p-2 focus-within:ring-2 focus-within:ring-indigo-500 transition-all">
                                        <div id="tags-container" class="flex flex-wrap"></div>
                                        <input type="text" id="event-tags-input" name="tags-input" placeholder="e.g. AI, Coding, Workshop" maxlength="20" class="flex-grow min-w-0 bg-transparent px-2 py-1 focus:outline-none" onkeydown="handleTagInput(event)" aria-label="Enter tags for the event">
                                        <input type="hidden" id="event-tags-hidden" name="tags">
                                    </div>
                                </div>
                            </fieldset>

                            <fieldset class="border border-gray-200 p-5 rounded-xl space-y-4">
                                <legend class="text-lg font-semibold px-2 text-gray-700 flex items-center"><i data-lucide="clock" class="h-5 w-5 mr-2 text-indigo-500"></i> Schedule & Location</legend>
                                
                                <div class="grid sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="event-start" class="block text-sm font-medium text-gray-700">Start Date & Time <span class="text-red-500">*</span></label>
                                        <input type="datetime-local" id="event-start" name="start" required oninput="validateTimeRange()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                        <p id="start-error" class="text-xs text-red-500 mt-1 hidden">Start time cannot be in the past.</p>
                                    </div>
                                    <div>
                                        <label for="event-end" class="block text-sm font-medium text-gray-700">End Date & Time <span class="text-red-500">*</span></label>
                                        <input type="datetime-local" id="event-end" name="end" required oninput="validateTimeRange()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                        <p id="end-error" class="text-xs text-red-500 mt-1 hidden">End time must be after the start time.</p>
                                    </div>
                                </div>

                                <div class="pt-2 border-t border-gray-100 space-y-3">
                                    <label class="block text-sm font-medium text-gray-700">Event Format <span class="text-red-500">*</span></label>
                                    <div class="flex gap-6">
                                        <label class="inline-flex items-center text-gray-900 font-medium cursor-pointer">
                                            <input type="radio" name="locationType" value="online" required checked onchange="toggleLocationFields('online')" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                            <span class="ml-2 flex items-center"><i data-lucide="globe" class="h-5 w-5 mr-1 text-indigo-500"></i> Online Event</span>
                                        </label>
                                        <label class="inline-flex items-center text-gray-900 font-medium cursor-pointer">
                                            <input type="radio" name="locationType" value="offline" required onchange="toggleLocationFields('offline')" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                            <span class="ml-2 flex items-center"><i data-lucide="map-pin" class="h-5 w-5 mr-1 text-indigo-500"></i> Offline Event</span>
                                        </label>
                                    </div>
                                </div>

                                <div id="location-fields-container" class="space-y-4">
                                    <div id="online-field">
                                        <label for="event-location-url" class="block text-sm font-medium text-gray-700">Meeting/Streaming URL <span class="text-red-500">*</span></label>
                                        <input type="url" id="event-location-url" name="locationURL" placeholder="https://zoom.us/join/..." required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                    </div>
                                    <div id="offline-field" class="hidden">
                                        <label for="event-venue" class="block text-sm font-medium text-gray-700">Venue Address / Room <span class="text-red-500">*</span></label>
                                        <input type="text" id="event-venue" name="locationVenue" placeholder="e.g. Main Hall, Block A" required disabled class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                    </div>
                                </div>
                            </fieldset>
                            
                            <fieldset class="border border-gray-200 p-5 rounded-xl space-y-4">
                                <legend class="text-lg font-semibold px-2 text-gray-700 flex items-center"><i data-lucide="image" class="h-5 w-5 mr-2 text-indigo-500"></i> Media Upload</legend>
                                
                                <div class="space-y-1">
                                    <label for="event-poster" class="block text-sm font-medium text-gray-700">Event Poster (Max 5MB) <span class="text-red-500">*</span></label>
                                    <input type="file" id="event-poster" name="poster" accept=".png, .jpg, .jpeg" required onchange="previewPoster(event)" class="w-full text-sm text-gray-500
                                        file:mr-4 file:py-2 file:px-4
                                        file:rounded-full file:border-0
                                        file:text-sm file:font-semibold
                                        file:bg-indigo-600 file:text-white
                                        hover:file:bg-indigo-700 transition-colors
                                        cursor-pointer">
                                    <p class="text-xs text-gray-500">Aspect ratio: 16:9 recommended. Appears in Live Preview.</p>
                                </div>

                                <div class="grid sm:grid-cols-2 gap-4">
                                    <div class="space-y-1">
                                        <label for="event-approval-form" class="block text-sm font-medium text-gray-700">Approval Form (PDF) <span class="text-red-500">*</span></label>
                                        <input type="file" id="event-approval-form" name="approvalForm" accept=".pdf" required class="w-full text-sm text-gray-500
                                            file:mr-4 file:py-2 file:px-4
                                            file:rounded-full file:border-0
                                            file:text-sm file:font-semibold
                                            file:bg-gray-700 file:text-white
                                            hover:file:bg-gray-800 transition-colors
                                            cursor-pointer">
                                    </div>
                                    <div class="space-y-1">
                                        <label for="event-brochure" class="block text-sm font-medium text-gray-700">Brochure (PDF, Optional)</label>
                                        <input type="file" id="event-brochure" name="brochure" accept=".pdf" class="w-full text-sm text-gray-500
                                            file:mr-4 file:py-2 file:px-4
                                            file:rounded-full file:border-0
                                            file:text-sm file:font-semibold
                                            file:bg-indigo-100 file:text-indigo-700
                                            hover:file:bg-indigo-200 transition-colors
                                            cursor-pointer">
                                    </div>
                                </div>
                            </fieldset>
                            
                            <fieldset class="border border-gray-200 p-5 rounded-xl space-y-4">
                                <legend class="text-lg font-semibold px-2 text-gray-700 flex items-center"><i data-lucide="ticket" class="h-5 w-5 mr-2 text-indigo-500"></i> Registration Setup</legend>

                                <div class="grid sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="max-participants" class="block text-sm font-medium text-gray-700">Max Participants <span class="text-red-500">*</span></label>
                                        <input type="number" id="max-participants" name="maxParticipants" placeholder="e.g. 300" min="1" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                    </div>
                                    <div>
                                        <label for="registration-deadline" class="block text-sm font-medium text-gray-700">Registration Deadline <span class="text-red-500">*</span></label>
                                        <input type="date" id="registration-deadline" name="deadline" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                    </div>
                                </div>

                                <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-200">
                                    <label for="waitlist-toggle" class="text-sm font-medium text-gray-900 flex items-center">
                                        <i data-lucide="list-checks" class="h-5 w-5 mr-2 text-green-700"></i> Enable Waitlist
                                    </label>
                                    <div class="form-switch">
                                        <input type="checkbox" id="waitlist-toggle" name="waitlistEnabled" class="sr-only" aria-checked="false">
                                        <span class="slider"></span>
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="registration-url" class="block text-sm font-medium text-gray-700">External Registration URL (Optional)</label>
                                    <input type="url" id="registration-url" name="registrationUrl" placeholder="If using external system, provide URL" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                </div>

                                <fieldset class="border border-gray-200 p-4 rounded-xl space-y-4">
                                    <legend class="text-lg font-semibold px-2 text-gray-700">Participant Details Collected</legend>

                                    <div class="bg-indigo-50 p-3 rounded-lg text-sm text-gray-800 font-medium border border-indigo-200 flex flex-wrap gap-x-4">
                                        <p><i data-lucide="check-circle" class="h-4 w-4 inline-block mr-1 text-indigo-600"></i> **Full Name** (Required)</p>
                                        <p><i data-lucide="check-circle" class="h-4 w-4 inline-block mr-1 text-indigo-600"></i> **Email Address** (Required)</p>
                                    </div>

                                    <div class="grid sm:grid-cols-2 gap-4">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="field-student-id" name="collectStudentId" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                            <label for="field-student-id" class="ml-2 block text-sm text-gray-900">Student ID</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="field-major" name="collectMajor" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                            <label for="field-major" class="ml-2 block text-sm text-gray-900">Major/Department</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="field-phone" name="collectPhone" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                            <label for="field-phone" class="ml-2 block text-sm text-gray-900">Phone Number</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="field-dietary" name="collectDietary" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                            <label for="field-dietary" class="ml-2 block text-sm text-gray-900">Dietary Needs/Allergies</label>
                                        </div>
                                    </div>
                                    
                                    <div class="pt-2 border-t border-gray-100">
                                        <label for="custom-question" class="block text-sm font-medium text-gray-700">Custom Question (Optional)</label>
                                        <input type="text" id="custom-question" name="customQuestion" placeholder="e.g. What is your favourite programming language?" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                    </div>
                                </fieldset>
                            </fieldset>

                        </div>
                        
                        <div class="flex justify-end pt-8 border-t border-gray-200 mt-10">
                            <button type="submit" class="px-8 py-3 bg-green-600 text-white rounded-full font-semibold hover:bg-green-700 transition-transform duration-200 hover:scale-105 shadow-md shadow-green-500/50" aria-label="Submit and publish event">
                                <i data-lucide="check-square" class="h-5 w-5 inline-block mr-2"></i> Review & Publish Event
                            </button>
                        </div>
                    </div>
                </form>
                
                <footer class="text-center text-sm text-gray-400 py-6 mt-8">
                    &copy; 2025 CampusEvents | 
                    <a href="/privacy" class="hover:text-gray-600 transition-colors">Privacy Policy</a> | 
                    <a href="/terms" class="hover:text-gray-600 transition-colors">Terms</a>
                </footer>
            </section>

            <aside id="preview-panel" class="hidden xl:block w-1/3 bg-gray-50 border-l border-gray-200 p-6 overflow-y-auto sticky top-20 h-[calc(100vh-80px)]">
                <div class="sticky top-0 pb-4 bg-gray-50">
                    <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                        <i data-lucide="eye" class="h-5 w-5 mr-2 text-indigo-600"></i>
                        Live Event Preview
                    </h2>
                    <p class="text-sm text-gray-500">Real-time visualization of your event card.</p>
                </div>
                
                <div id="event-card-preview" class="mt-4 bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl border-t-4 border-indigo-600">
                    <div id="preview-poster-container" class="h-40 bg-gray-200 flex items-center justify-center text-gray-500 font-medium overflow-hidden relative">
                        <div class="absolute inset-0 bg-gradient-to-t from-gray-900/10 to-transparent"></div>
                        <i data-lucide="image" id="preview-poster-icon" class="h-10 w-10"></i>
                        <img id="preview-poster-img" src="" alt="Event Poster Preview" class="absolute inset-0 w-full h-full object-cover hidden">
                    </div>
                    <div class="p-4">
                        <p class="text-xs font-semibold uppercase tracking-wider mb-1 transition-colors duration-300" id="preview-category">CATEGORY</p>
                        <h3 class="text-xl font-bold text-gray-900 mb-2" id="preview-title">Event Title Here</h3>
                        <p class="text-sm text-gray-600 mb-3 line-clamp-3" id="preview-description">Brief description...</p>
                        <div class="space-y-1 text-sm text-gray-700 border-t pt-3 mt-3">
                            <div class="flex items-center">
                                <i data-lucide="clock" class="h-4 w-4 mr-2 text-indigo-500"></i>
                                <span id="preview-schedule">TBD</span>
                            </div>
                            <div class="flex items-center">
                                <i data-lucide="map-pin" class="h-4 w-4 mr-2 text-indigo-500"></i>
                                <span id="preview-location">Online Event</span>
                            </div>
                        </div>
                        <button class="mt-4 w-full text-center py-2 text-sm font-semibold rounded-full bg-indigo-600 text-white hover:bg-indigo-700 transition-colors hover:shadow-lg hover:shadow-indigo-500/50">
                            Register Now
                        </button>
                    </div>
                </div>
            </aside>
            
        </main>
    </div>

    <script>
        // --- Global Elements and Configuration ---
        const form = document.getElementById('event-form');
        const previewCard = document.getElementById('event-card-preview');
        const charCount = document.getElementById('char-count');
        const livePathSpan = document.getElementById('live-path');

        const livePreview = {
            title: document.getElementById('preview-title'),
            description: document.getElementById('preview-description'),
            category: document.getElementById('preview-category'),
            schedule: document.getElementById('preview-schedule'),
            location: document.getElementById('preview-location'),
            posterImg: document.getElementById('preview-poster-img'),
            posterIcon: document.getElementById('preview-poster-icon')
        };
        
        const tagsInput = document.getElementById('event-tags-input');
        const tagsContainer = document.getElementById('tags-container');
        const tagsHidden = document.getElementById('event-tags-hidden');
        let activeTags = [];
        
        // Conditional Location Fields
        const onlineField = document.getElementById('online-field');
        const offlineField = document.getElementById('offline-field');
        const locationURLInput = document.getElementById('event-location-url');
        const locationVenueInput = document.getElementById('event-venue');

        // Category Color Mapping for Live Styling
        const categoryColors = {
            'Technical': { text: 'text-blue-600', border: 'border-blue-600' },
            'Cultural': { text: 'text-pink-600', border: 'border-pink-600' },
            'Sports': { text: 'text-green-600', border: 'border-green-600' },
            'Workshop': { text: 'text-purple-600', border: 'border-purple-600' },
            'Seminar': { text: 'text-yellow-600', border: 'border-yellow-600' },
            'Festival': { text: 'text-red-600', border: 'border-red-600' },
        };
        
        // --- Form Submission / Final Validation ---
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            // A final validation check before submission (using the existing logic)
            if (validateForm()) {
                alert('Form is valid! Submitting event: ' + form.elements['title'].value);
                // In a real application, AJAX submission logic would go here
            } else {
                alert('Please correct the highlighted errors before submitting.');
            }
        });

        function validateForm() {
            // Validate all required fields in the single-step form
            const requiredFields = form.querySelectorAll('[required]:not([disabled])');
            let isValid = true;
            let firstInvalidField = null;

            requiredFields.forEach(field => {
                field.classList.remove('input-error');

                if (field.type === 'datetime-local' && field.id.includes('end') && !validateTimeRange(true)) {
                    isValid = false;
                } else if (!field.value.trim()) {
                    field.classList.add('input-error');
                    if (!firstInvalidField) firstInvalidField = field;
                    isValid = false;
                }
            });

            if (!isValid) {
                if (firstInvalidField) firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            return isValid;
        }

        // --- Location Selector Logic ---
        function toggleLocationFields(type) {
            // Set input requirements and visibility based on type
            const isOnline = type === 'online';

            onlineField.classList.toggle('hidden', !isOnline);
            offlineField.classList.toggle('hidden', isOnline);

            locationURLInput.required = isOnline;
            locationURLInput.disabled = !isOnline;
            locationVenueInput.required = !isOnline;
            locationVenueInput.disabled = isOnline;

            // Clear disabled field values to prevent incorrect submission data
            if (isOnline) {
                locationVenueInput.value = '';
            } else {
                locationURLInput.value = '';
            }

            // Update live preview immediately
            const currentValue = isOnline ? locationURLInput.value : locationVenueInput.value;
            updateLocationPreview(currentValue, type);
        }

        function updateLocationPreview(value, type) {
            const currentType = document.querySelector('input[name="locationType"]:checked').value;
            const mapIcon = '<i data-lucide="map-pin" class="h-4 w-4 mr-2 text-indigo-500"></i>';
            const globeIcon = '<i data-lucide="globe" class="h-4 w-4 mr-2 text-indigo-500"></i>';
            
            if (currentType === 'online') {
                livePreview.location.innerHTML = globeIcon + (value ? 'Online via Link' : 'Online Event');
            } else {
                livePreview.location.innerHTML = mapIcon + (value ? value : 'Offline Event');
            }
            // Re-render lucide icons
            lucide.createIcons();
        }

        // --- Live Poster Preview Functionality ---
        function previewPoster(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    livePreview.posterImg.src = e.target.result;
                    livePreview.posterImg.classList.remove('hidden');
                    livePreview.posterIcon.classList.add('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                livePreview.posterImg.src = '';
                livePreview.posterImg.classList.add('hidden');
                livePreview.posterIcon.classList.remove('hidden');
            }
        }

        // --- Event Path (URL Slug) Sanitization ---
        function sanitizePath(event) {
            let value = event.target.value.toLowerCase() // Lowercase
                                          .replace(/\s+/g, '-')     // Spaces to hyphens
                                          .replace(/[^a-z0-9-]/g, ''); // Remove special characters except hyphens

            event.target.value = value;
            livePathSpan.textContent = value || 'event-path-here';
        }

        // --- Date/Time Validation and Update ---
        function validateTimeRange(isFinalCheck = false) {
            const startInput = form.elements['start'];
            const endInput = form.elements['end'];
            const startTime = new Date(startInput.value);
            const endTime = new Date(endInput.value);
            const now = new Date();
            let isValid = true;

            startInput.classList.remove('input-error', 'input-success');
            endInput.classList.remove('input-error', 'input-success');
            document.getElementById('start-error').classList.add('hidden');
            document.getElementById('end-error').classList.add('hidden');

            if (startInput.value) {
                if (startTime < now) {
                    startInput.classList.add('input-error');
                    document.getElementById('start-error').textContent = 'Start time cannot be in the past.';
                    document.getElementById('start-error').classList.remove('hidden');
                    isValid = false;
                } else {
                    startInput.classList.add('input-success');
                }
            }

            if (startInput.value && endInput.value) {
                if (endTime <= startTime) {
                    endInput.classList.add('input-error');
                    document.getElementById('end-error').textContent = 'End time must be after the start time.';
                    document.getElementById('end-error').classList.remove('hidden');
                    isValid = false;
                } else {
                    endInput.classList.add('input-success');
                }
            }
            
            updateSchedulePreview();
            return isValid;
        }

        function updateSchedulePreview() {
            const startVal = form.elements['start'].value;
            const endVal = form.elements['end'].value;
            const formatOptions = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            
            if (startVal) {
                const start = new Date(startVal);
                let scheduleText = start.toLocaleDateString('en-US', formatOptions);
                if (endVal) {
                    const end = new Date(endVal);
                    scheduleText += ` - ${end.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}`;
                }
                livePreview.schedule.textContent = scheduleText;
            } else {
                livePreview.schedule.textContent = 'TBD';
            }
        }


        // --- Real-time Input Handler (for Title, Description, Category) ---
        form.addEventListener('input', (e) => {
            const fieldName = e.target.name;
            let value = e.target.value;

            switch (fieldName) {
                case 'title':
                    livePreview.title.textContent = value || 'Event Title Here';
                    break;
                case 'description':
                    livePreview.description.textContent = value.substring(0, 150) + (value.length > 150 ? '...' : '') || 'Brief description...';
                    charCount.textContent = value.length; 
                    break;
                case 'category':
                    livePreview.category.textContent = value.toUpperCase() || 'CATEGORY';
                    Object.values(categoryColors).forEach(style => {
                        previewCard.classList.remove(style.border);
                        livePreview.category.classList.remove(style.text);
                    });
                    const color = categoryColors[value] || { text: 'text-gray-900', border: 'border-indigo-600' };
                    previewCard.classList.add(color.border);
                    livePreview.category.classList.add(color.text);
                    break;
                case 'locationURL':
                case 'locationVenue':
                    // This handles input on the visible location field
                    const type = document.querySelector('input[name="locationType"]:checked').value;
                    updateLocationPreview(value, type);
                    break;
            }
        });

        // --- Tags Input Logic ---
        function handleTagInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const tagText = tagsInput.value.trim();
                
                if (tagText.length > 20) {
                     tagsInput.classList.add('input-error');
                     alert('Tag text is too long (max 20 characters).');
                     setTimeout(() => tagsInput.classList.remove('input-error'), 500);
                     return;
                }

                if (tagText && activeTags.length < 5 && !activeTags.includes(tagText)) {
                    activeTags.push(tagText);
                    renderTags();
                    tagsInput.value = '';
                } else if (activeTags.includes(tagText)) {
                    tagsInput.classList.add('input-error');
                    setTimeout(() => tagsInput.classList.remove('input-error'), 500);
                }
            }
            if (event.key === 'Backspace' && tagsInput.value === '' && activeTags.length > 0) {
                removeTag(activeTags[activeTags.length - 1]);
            }
        }

        function removeTag(tagText) {
            activeTags = activeTags.filter(t => t !== tagText);
            renderTags();
        }

        function renderTags() {
            tagsContainer.innerHTML = '';
            activeTags.forEach(tag => {
                const tagEl = document.createElement('span');
                tagEl.className = 'tag-pill';
                tagEl.innerHTML = `
                    ${tag}
                    <button type="button" class="ml-2 -mr-1 h-4 w-4 text-indigo-700 hover:text-indigo-900 focus:outline-none" onclick="removeTag('${tag}')" aria-label="Remove tag ${tag}">
                        <i data-lucide="x" class="h-4 w-4"></i>
                    </button>
                `;
                tagsContainer.appendChild(tagEl);
            });
            tagsHidden.value = activeTags.join(',');
            lucide.createIcons();
        }
        
        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const menuToggle = document.getElementById('menu-toggle');
            
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
                overlay.classList.toggle('hidden');
            });

            overlay.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            });

            // Set initial state for Online Location fields
            toggleLocationFields('online');

            // Set initial required fields (not handled by the toggle logic)
            form.elements['maxParticipants'].setAttribute('required', 'required');
            form.elements['deadline'].setAttribute('required', 'required');
            form.elements['event-poster'].setAttribute('required', 'required');
            form.elements['event-approval-form'].setAttribute('required', 'required');

            // Initial rendering of icons
            lucide.createIcons();
        });
    </script>
</body>
</html>